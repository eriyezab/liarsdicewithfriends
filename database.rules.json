{
  "rules": {
    "lobbies": {
      "$lobbyId": {
        ".read": "auth != null",
        ".write": "!data.exists() && auth != null",

        "createdAt": {
          ".write": "!data.exists()"
        },

        "hostId": {
          ".write": "!data.exists()"
        },

        "gameMode": {
          ".write": "auth.uid === root.child('lobbies').child($lobbyId).child('hostId').val()"
        },

        "maxPlayers": {
          ".write": "!data.exists()"
        },

        "players": {
          "$playerId": {
            ".write": "!data.exists() && auth.uid === $playerId && root.child('lobbies').child($lobbyId).child('status').val() === 'waiting'"
          },
          ".indexOn": ["joinedAt"]
        },

        "playerSecrets": {
          "$playerId": {
            ".read": "auth.uid === $playerId",
            ".write": "auth.uid === $playerId || auth.uid === root.child('lobbies').child($lobbyId).child('hostId').val()"
          }
        },

        "gameState": {
          ".read": "root.child('lobbies').child($lobbyId).child('players').hasChild(auth.uid)",
          ".write": "root.child('lobbies').child($lobbyId).child('players').hasChild(auth.uid)"
        },

        "status": {
          ".write": "auth.uid === root.child('lobbies').child($lobbyId).child('hostId').val()"
        },

        "history": {
          ".read": "root.child('lobbies').child($lobbyId).child('players').hasChild(auth.uid)",
          "$historyId": {
            ".write": "root.child('lobbies').child($lobbyId).child('players').hasChild(auth.uid)"
          }
        }
      }
    }
  }
}